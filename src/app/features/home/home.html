<div class="home-page" [class.lang-transitioning]="isChangingLanguage()">
  <!-- Navigation Bar -->
  <nav class="navbar">
    <!-- Left Section: Logo + Tabs -->
    <div class="nav-left">
      <div class="logo">
        <span class="logo-img" aria-hidden="true"></span>
        <span>PirateFlix</span>
      </div>

      <div class="nav-tabs">
        <button
          class="nav-tab"
          [class.active]="activeTab() === 'movies'"
          (click)="activeTab.set('movies')"
        >
          <mat-icon>movie</mat-icon>
          <span class="translate-text">{{ 'Movies' | t }}</span>
        </button>
        <button
          class="nav-tab"
          [class.active]="activeTab() === 'tv'"
          (click)="activeTab.set('tv')"
        >
          <mat-icon>tv</mat-icon>
          <span class="translate-text">{{ 'TV Shows' | t }}</span>
        </button>
        <button
          class="nav-tab"
          [class.active]="activeTab() === 'search'"
          (click)="activeTab.set('search')"
        >
          <mat-icon>search</mat-icon>
          <span class="translate-text">{{ 'Search' | t }}</span>
        </button>
      </div>
    </div>

    <!-- Center Section: Empty -->
    <div class="nav-center"></div>

    <!-- Right Section: Grid Toggle + Profile -->
    <div class="nav-right">
      <!-- Grid Toggle (unified) -->
      <button
        class="grid-toggle"
        (click)="cycleGridSize()"
        [title]="'Toggle view' | t"
      >
        <mat-icon>{{ getGridIcon() }}</mat-icon>
      </button>

      <!-- Profile Menu -->
      <div class="profile-menu">
        <button
          class="profile-avatar"
          [class.authenticated]="isAuthenticated()"
          (click)="toggleProfileMenu()"
          [title]="isAuthenticated() ? userDisplayName() : ('Sign in' | t)"
        >
          <mat-icon>account_circle</mat-icon>
          <mat-icon class="dropdown-caret" [class.open]="profileMenuOpen()">expand_more</mat-icon>
        </button>

        <!-- Profile Dropdown Menu -->
        <div class="profile-dropdown" [class.open]="profileMenuOpen()">
          <div class="dropdown-header" *ngIf="isAuthenticated()">
            <span class="user-name">{{ userDisplayName() }}</span>
          </div>
          
          <div class="dropdown-divider" *ngIf="isAuthenticated()"></div>

          <button class="dropdown-item" *ngIf="!isAuthenticated()" (click)="login(); closeProfileMenu()">
            <mat-icon>login</mat-icon>
            <span class="translate-text">{{ 'Sign in' | t }}</span>
          </button>

          <button class="dropdown-item" *ngIf="isAuthenticated()" (click)="navigateToProfile(); closeProfileMenu()">
            <mat-icon>person</mat-icon>
            <span class="translate-text">{{ 'Profile' | t }}</span>
          </button>

          <button class="dropdown-item" (click)="navigateToSettings(); closeProfileMenu()">
            <mat-icon>settings</mat-icon>
            <span class="translate-text">{{ 'Settings' | t }}</span>
          </button>

          <div class="dropdown-submenu">
            <button class="dropdown-item has-submenu" (click)="toggleLanguageSubmenu()">
              <mat-icon>language</mat-icon>
              <span class="translate-text">{{ 'Language' | t }}</span>
              <mat-icon class="submenu-arrow" [class.open]="languageSubmenuOpen()">chevron_right</mat-icon>
            </button>
            <div class="submenu-content" [class.open]="languageSubmenuOpen()">
              <button 
                class="submenu-item" 
                [class.selected]="currentLang() === 'en'"
                (click)="changeLang('en'); closeProfileMenu()"
              >
                <span class="flag">ðŸ‡¬ðŸ‡§</span>
                <span>English</span>
                <mat-icon *ngIf="currentLang() === 'en'" class="check-icon">check</mat-icon>
              </button>
              <button 
                class="submenu-item" 
                [class.selected]="currentLang() === 'es'"
                (click)="changeLang('es'); closeProfileMenu()"
              >
                <span class="flag">ðŸ‡ªðŸ‡¸</span>
                <span>EspaÃ±ol</span>
                <mat-icon *ngIf="currentLang() === 'es'" class="check-icon">check</mat-icon>
              </button>
            </div>
          </div>

          <div class="dropdown-divider" *ngIf="isAuthenticated()"></div>

          <button class="dropdown-item sign-out" *ngIf="isAuthenticated()" (click)="logout(); closeProfileMenu()">
            <mat-icon>logout</mat-icon>
            <span class="translate-text">{{ 'Sign out' | t }}</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Loading Bar -->
  <div class="loading-bar" *ngIf="loading()">
    <div class="loading-progress"></div>
  </div>

  <!-- ========================================
       MOVIES TAB
       ======================================== -->
  <div class="tab-content" *ngIf="activeTab() === 'movies'">
    <!-- Movies Hero -->
    <section class="hero" *ngIf="!loading() && movies().length">
      <div class="hero-backdrop" [style.backgroundImage]="'url(' + getMovieHeroBackdrop() + ')'"></div>
      <div class="hero-gradient"></div>
      <div class="hero-content">
        <span class="hero-badge">
          <mat-icon>movie</mat-icon>
          <span class="translate-text">{{ 'Featured Movie' | t }}</span>
        </span>
        <h1 class="hero-title">{{ getMovieHero()?.title }}</h1>
        <p class="hero-overview">{{ getMovieHero()?.overview }}</p>
        <div class="hero-meta">
          <span class="hero-rating" *ngIf="getMovieHero()?.vote_average">
            <mat-icon>star</mat-icon>
            {{ getMovieHero()?.vote_average | number:'1.1-1' }}
          </span>
          <span>{{ getMovieHero()?.release_date | date:'yyyy' }}</span>
        </div>
        <div class="hero-actions">
          <button class="btn-play" (click)="openDetails('movie', getMovieHero()?.id)">
            <mat-icon>play_arrow</mat-icon>
            <span class="translate-text">{{ 'Watch now' | t }}</span>
          </button>
          <button class="btn-info" (click)="openDetails('movie', getMovieHero()?.id)">
            <mat-icon>info_outline</mat-icon>
            <span class="translate-text">{{ 'More info' | t }}</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Movies Loading Skeleton -->
    <main class="main-content" *ngIf="loading()">
      <section class="section">
        <div class="section-header skeleton-header">
          <div class="skeleton-title"></div>
          <div class="skeleton-count"></div>
        </div>
        <div class="content-grid" [class.size-small]="gridSize() === 1" [class.size-medium]="gridSize() === 2" [class.size-large]="gridSize() === 3" [class.grid-transitioning]="gridTransitioning()">
          <div class="grid-card skeleton-card" *ngFor="let _ of skeletonCount">
            <div class="card-poster skeleton-poster">
              <div class="skeleton-shimmer"></div>
            </div>
            <div class="card-info">
              <div class="skeleton-text skeleton-text-title"></div>
              <div class="skeleton-text skeleton-text-year"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Movies Grid -->
    <main class="main-content" *ngIf="!loading()">
      <section class="section" *ngIf="!error()">
        <div class="section-header">
          <h2 class="section-title translate-text">{{ 'Trending Movies' | t }}</h2>
          <span class="section-count translate-text">{{ movies().length }} {{ 'titles' | t }}</span>
        </div>

        <div class="content-grid" [class.size-small]="gridSize() === 1" [class.size-medium]="gridSize() === 2" [class.size-large]="gridSize() === 3" [class.grid-transitioning]="gridTransitioning()">
          <div
            class="grid-card"
            *ngFor="let item of movies(); let i = index"
            (click)="openDetails('movie', item.id)"
            [class.featured]="i === 0"
          >
            <div class="card-poster">
              <img [src]="posterOrPlaceholder(item.poster_path)" [alt]="item.title" [title]="item.title" loading="lazy" />
              <div class="card-overlay">
                <div class="overlay-top">
                  <span class="card-rank">#{{ i + 1 }}</span>
                </div>
                <div class="overlay-bottom">
                  <button class="play-btn">
                    <mat-icon>play_arrow</mat-icon>
                  </button>
                </div>
              </div>
              <div class="card-rating" *ngIf="item.vote_average">
                <mat-icon>star</mat-icon>
                {{ item.vote_average | number:'1.1-1' }}
              </div>
            </div>
            <div class="card-info">
              <div class="card-title">{{ item.title }}</div>
              <div class="card-year">{{ item.release_date | date:'yyyy' }}</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Error -->
      <div class="error-banner" *ngIf="error()">
        <mat-icon>error_outline</mat-icon>
        <span>{{ error() }}</span>
        <button class="btn-retry" (click)="refreshTrending()">{{ 'Retry' | t }}</button>
      </div>
    </main>
  </div>

  <!-- ========================================
       TV SHOWS TAB
       ======================================== -->
  <div class="tab-content" *ngIf="activeTab() === 'tv'">
    <!-- TV Hero -->
    <section class="hero" *ngIf="!loading() && tv().length">
      <div class="hero-backdrop" [style.backgroundImage]="'url(' + getTvHeroBackdrop() + ')'"></div>
      <div class="hero-gradient"></div>
      <div class="hero-content">
        <span class="hero-badge">
          <mat-icon>tv</mat-icon>
          <span class="translate-text">{{ 'Featured TV Show' | t }}</span>
        </span>
        <h1 class="hero-title">{{ getTvHero()?.name }}</h1>
        <p class="hero-overview">{{ getTvHero()?.overview }}</p>
        <div class="hero-meta">
          <span class="hero-rating" *ngIf="getTvHero()?.vote_average">
            <mat-icon>star</mat-icon>
            {{ getTvHero()?.vote_average | number:'1.1-1' }}
          </span>
          <span>{{ getTvHero()?.first_air_date | date:'yyyy' }}</span>
        </div>
        <div class="hero-actions">
          <button class="btn-play" (click)="openDetails('tv', getTvHero()?.id)">
            <mat-icon>play_arrow</mat-icon>
            <span class="translate-text">{{ 'Watch now' | t }}</span>
          </button>
          <button class="btn-info" (click)="openDetails('tv', getTvHero()?.id)">
            <mat-icon>info_outline</mat-icon>
            <span class="translate-text">{{ 'More info' | t }}</span>
          </button>
        </div>
      </div>
    </section>

    <!-- TV Loading Skeleton -->
    <main class="main-content" *ngIf="loading()">
      <section class="section">
        <div class="section-header skeleton-header">
          <div class="skeleton-title"></div>
          <div class="skeleton-count"></div>
        </div>
        <div class="content-grid" [class.size-small]="gridSize() === 1" [class.size-medium]="gridSize() === 2" [class.size-large]="gridSize() === 3" [class.grid-transitioning]="gridTransitioning()">
          <div class="grid-card skeleton-card" *ngFor="let _ of skeletonCount">
            <div class="card-poster skeleton-poster">
              <div class="skeleton-shimmer"></div>
            </div>
            <div class="card-info">
              <div class="skeleton-text skeleton-text-title"></div>
              <div class="skeleton-text skeleton-text-year"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- TV Grid -->
    <main class="main-content" *ngIf="!loading()">
      <section class="section" *ngIf="!error()">
        <div class="section-header">
          <h2 class="section-title translate-text">{{ 'Trending TV Shows' | t }}</h2>
          <span class="section-count translate-text">{{ tv().length }} {{ 'titles' | t }}</span>
        </div>

        <div class="content-grid" [class.size-small]="gridSize() === 1" [class.size-medium]="gridSize() === 2" [class.size-large]="gridSize() === 3" [class.grid-transitioning]="gridTransitioning()">
          <div
            class="grid-card"
            *ngFor="let item of tv(); let i = index"
            (click)="openDetails('tv', item.id)"
            [class.featured]="i === 0"
          >
            <div class="card-poster">
              <img [src]="posterOrPlaceholder(item.poster_path)" [alt]="item.name" [title]="item.name" loading="lazy" />
              <div class="card-overlay">
                <div class="overlay-top">
                  <span class="card-rank">#{{ i + 1 }}</span>
                </div>
                <div class="overlay-bottom">
                  <button class="play-btn">
                    <mat-icon>play_arrow</mat-icon>
                  </button>
                </div>
              </div>
              <div class="card-rating" *ngIf="item.vote_average">
                <mat-icon>star</mat-icon>
                {{ item.vote_average | number:'1.1-1' }}
              </div>
            </div>
            <div class="card-info">
              <div class="card-title">{{ item.name }}</div>
              <div class="card-year">{{ item.first_air_date | date:'yyyy' }}</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Error -->
      <div class="error-banner" *ngIf="error()">
        <mat-icon>error_outline</mat-icon>
        <span>{{ error() }}</span>
        <button class="btn-retry" (click)="refreshTrending()">{{ 'Retry' | t }}</button>
      </div>
    </main>
  </div>

  <!-- ========================================
       SEARCH TAB
       ======================================== -->
  <div class="tab-content search-tab" *ngIf="activeTab() === 'search'">
    <main class="main-content search-main">
      <section class="search-section">
        <div class="search-header">
          <h1 class="search-page-title translate-text">{{ 'Search' | t }}</h1>
          <p class="search-subtitle translate-text">{{ 'Find movies, TV shows, and people' | t }}</p>
        </div>

        <div class="search-container">
          <div class="search-input-wrapper">
            <mat-icon class="search-icon">search</mat-icon>
            <input
              type="text"
              class="search-input"
              [placeholder]="'Search...' | t"
              [ngModel]="query()"
              (ngModelChange)="setQuery($event)"
              (keydown.enter)="doSearch()"
              autocomplete="off"
            />
            <button class="search-clear" *ngIf="query().trim().length" (click)="clearSearch()">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          <div class="search-filters">
            <button
              class="filter-chip"
              [class.active]="searchFilter() === 'all'"
              (click)="setSearchFilter('all')"
            >{{ 'All' | t }}</button>
            <button
              class="filter-chip"
              [class.active]="searchFilter() === 'movie'"
              (click)="setSearchFilter('movie')"
            >{{ 'Movies' | t }}</button>
            <button
              class="filter-chip"
              [class.active]="searchFilter() === 'tv'"
              (click)="setSearchFilter('tv')"
            >{{ 'TV Shows' | t }}</button>
            <button
              class="filter-chip"
              [class.active]="searchFilter() === 'person'"
              (click)="setSearchFilter('person')"
            >{{ 'People' | t }}</button>
          </div>
        </div>

        <!-- Search Loading Skeleton -->
        <div class="search-skeleton-grid" *ngIf="searchLoading()">
          <div class="content-grid" [class.size-small]="gridSize() === 1" [class.size-medium]="gridSize() === 2" [class.size-large]="gridSize() === 3">
            <div class="grid-card skeleton-card" *ngFor="let _ of skeletonCount.slice(0, 8)">
              <div class="card-poster skeleton-poster">
                <div class="skeleton-shimmer"></div>
              </div>
              <div class="card-info">
                <div class="skeleton-text skeleton-text-title"></div>
                <div class="skeleton-text skeleton-text-year"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Search Error -->
        <div class="search-error" *ngIf="searchError()">
          <mat-icon>error_outline</mat-icon>
          <span>{{ searchError() }}</span>
        </div>

        <!-- Search Results Grid -->
        <div class="content-grid search-grid" [class.size-small]="gridSize() === 1" [class.size-medium]="gridSize() === 2" [class.size-large]="gridSize() === 3" *ngIf="hasSearch() && !searchLoading() && !searchError() && searchResultsFiltered().length">
          <div
            class="grid-card"
            *ngFor="let item of searchResultsFiltered()"
            (click)="openDetailsForResult(item)"
          >
            <div class="card-poster">
              <img [src]="posterOrPlaceholder(item.poster_path || item.profile_path)" [alt]="title(item)" [title]="title(item)" loading="lazy" />
              <div class="card-overlay">
                <div class="overlay-top">
                  <span class="media-badge">{{ labelMediaType(item.media_type) | t }}</span>
                </div>
                <div class="overlay-bottom">
                  <button class="play-btn">
                    <mat-icon>play_arrow</mat-icon>
                  </button>
                </div>
              </div>
              <div class="card-rating" *ngIf="item.vote_average">
                <mat-icon>star</mat-icon>
                {{ item.vote_average | number:'1.1-1' }}
              </div>
            </div>
            <div class="card-info">
              <div class="card-title">{{ title(item) }}</div>
              <div class="card-year">
                {{ (item.release_date || item.first_air_date) | date:'yyyy' }}
              </div>
            </div>
          </div>
        </div>

        <!-- No Results -->
        <div class="no-results" *ngIf="hasSearch() && !searchLoading() && !searchError() && !searchResultsFiltered().length">
          <mat-icon>search_off</mat-icon>
          <p class="translate-text">{{ 'No results found' | t }}</p>
        </div>

        <!-- Empty State -->
        <div class="empty-search" *ngIf="!hasSearch() && !searchLoading()">
          <mat-icon>movie_filter</mat-icon>
          <p class="translate-text">{{ 'Type something to search' | t }}</p>
        </div>
      </section>
    </main>
  </div>

</div>
