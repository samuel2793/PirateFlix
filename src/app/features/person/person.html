<div class="person-page" *ngIf="!loading(); else loadingTpl">
  <!-- Error State -->
  <div class="error-state" *ngIf="error()">
    <mat-icon>error_outline</mat-icon>
    <h2 i18n>Error loading</h2>
    <p>{{ error() }}</p>
    <button mat-flat-button routerLink="/" i18n>Back to home</button>
  </div>

  <ng-container *ngIf="!error() && person() as p">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-bg"></div>
      
      <div class="hero-content">
        <!-- Photo -->
        <div class="photo-container">
          <img [src]="photo()" [alt]="name()" class="photo" />
        </div>

        <!-- Info -->
        <div class="info-container">
          <h1 class="name">{{ name() }}</h1>

          <!-- Quick Stats -->
          <div class="stats">
            <div class="stat" *ngIf="knownFor()">
              <mat-icon>work</mat-icon>
              <span>{{ knownFor() }}</span>
            </div>
            <div class="stat" *ngIf="totalMovies() > 0">
              <mat-icon>movie</mat-icon>
              <span *ngIf="totalMovies() === 1" i18n>{{ totalMovies() }} movie</span>
              <span *ngIf="totalMovies() !== 1" i18n>{{ totalMovies() }} movies</span>
            </div>
            <div class="stat" *ngIf="totalTvShows() > 0">
              <mat-icon>tv</mat-icon>
              <span *ngIf="totalTvShows() === 1" i18n>{{ totalTvShows() }} TV show</span>
              <span *ngIf="totalTvShows() !== 1" i18n>{{ totalTvShows() }} TV shows</span>
            </div>
          </div>

          <!-- Personal Info -->
          <div class="personal-info">
            <div class="info-item" *ngIf="birthDate() !== 'â€”'">
              <span class="info-label" i18n>Birth</span>
              <span class="info-value">{{ birthDate() }}</span>
            </div>
            <div class="info-item" *ngIf="deathDate()">
              <span class="info-label" i18n>Death</span>
              <span class="info-value">{{ deathDate() }}</span>
            </div>
            <div class="info-item" *ngIf="age()">
              <span class="info-label" *ngIf="deathDate()" i18n>Age at death</span>
              <span class="info-label" *ngIf="!deathDate()" i18n>Age</span>
              <span class="info-value" *ngIf="age() === 1" i18n>{{ age() }} year</span>
              <span class="info-value" *ngIf="age() !== 1" i18n>{{ age() }} years</span>
            </div>
            <div class="info-item wide" *ngIf="birthPlace()">
              <span class="info-label" i18n>Place of birth</span>
              <span class="info-value">{{ birthPlace() }}</span>
            </div>
          </div>

          <!-- Biography -->
          <div class="biography">
            <h3 i18n>Biography</h3>
            <p class="bio-text">{{ showFullBio() ? biography() : shortBio() }}</p>
            <button class="bio-toggle" *ngIf="hasBioOverflow()" (click)="toggleBio()">
              <ng-container *ngIf="showFullBio(); else showMoreBio">
                <span i18n>Show less</span>
              </ng-container>
              <ng-template #showMoreBio>
                <span i18n>Show more</span>
              </ng-template>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Acting Credits -->
    <section class="section credits-section" *ngIf="actingCredits().length">
      <h2 class="section-title">
        <mat-icon>theater_comedy</mat-icon>
        <span i18n>Acting</span>
      </h2>
      <div class="credits-grid">
        <a 
          class="credit-card" 
          *ngFor="let credit of actingCredits()" 
          [routerLink]="['/details', credit.media_type, credit.id]"
        >
          <div class="credit-poster">
            <img [src]="getPoster(credit)" [alt]="getTitle(credit)" loading="lazy" />
            <div class="credit-overlay">
              <span class="media-badge">{{ getMediaType(credit) }}</span>
            </div>
          </div>
          <div class="credit-info">
            <h4 class="credit-title">{{ getTitle(credit) }}</h4>
            <p class="credit-role" *ngIf="getRole(credit)">{{ getRole(credit) }}</p>
            <span class="credit-year" *ngIf="getYear(credit)">{{ getYear(credit) }}</span>
          </div>
        </a>
      </div>
    </section>

    <!-- Crew Credits -->
    <section class="section credits-section" *ngIf="hasCrewCredits()">
      <h2 class="section-title">
        <mat-icon>videocam</mat-icon>
        <span i18n>Crew</span>
      </h2>
      <div class="credits-grid">
        <a 
          class="credit-card" 
          *ngFor="let credit of crewCredits()" 
          [routerLink]="['/details', credit.media_type, credit.id]"
        >
          <div class="credit-poster">
            <img [src]="getPoster(credit)" [alt]="getTitle(credit)" loading="lazy" />
            <div class="credit-overlay">
              <span class="media-badge">{{ getMediaType(credit) }}</span>
            </div>
          </div>
          <div class="credit-info">
            <h4 class="credit-title">{{ getTitle(credit) }}</h4>
            <p class="credit-role" *ngIf="getRole(credit)">{{ getRole(credit) }}</p>
            <span class="credit-year" *ngIf="getYear(credit)">{{ getYear(credit) }}</span>
          </div>
        </a>
      </div>
    </section>
  </ng-container>
</div>

<ng-template #loadingTpl>
  <div class="person-page loading-state">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p i18n>Loading...</p>
    </div>
  </div>
</ng-template>
