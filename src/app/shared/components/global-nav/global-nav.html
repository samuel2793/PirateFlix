<nav class="global-nav" *ngIf="showNav()">
  <!-- Left Section: Logo + Brand + Back Button -->
  <div class="nav-left">
    <a class="brand" routerLink="/" [title]="'Home' | t">
      <span class="brand-logo" aria-hidden="true"></span>
      <span class="brand-name">PirateFlix</span>
    </a>

    <button
      class="back-btn"
      (click)="goBack()"
      [title]="'Back' | t"
    >
      <mat-icon>arrow_back</mat-icon>
      <span class="back-text translate-text">{{ 'Back' | t }}</span>
    </button>
  </div>

  <!-- Center Section: Empty for balance -->
  <div class="nav-center"></div>

  <!-- Right Section: Profile Avatar with Dropdown -->
  <div class="nav-right">
    <div class="profile-menu">
      <button
        class="profile-avatar"
        [class.authenticated]="isAuthenticated()"
        (click)="toggleProfileMenu()"
        [title]="isAuthenticated() ? userDisplayName() : ('Sign in' | t)"
      >
        <mat-icon>account_circle</mat-icon>
        <mat-icon class="dropdown-caret" [class.open]="profileMenuOpen()">expand_more</mat-icon>
      </button>

      <!-- Profile Dropdown Menu -->
      <div class="profile-dropdown" [class.open]="profileMenuOpen()">
        <div class="dropdown-header" *ngIf="isAuthenticated()">
          <span class="user-name">{{ userDisplayName() }}</span>
        </div>
        
        <div class="dropdown-divider" *ngIf="isAuthenticated()"></div>

        <button class="dropdown-item" *ngIf="!isAuthenticated()" (click)="login(); closeProfileMenu()">
          <mat-icon>login</mat-icon>
          <span class="translate-text">{{ 'Sign in' | t }}</span>
        </button>

        <button class="dropdown-item" *ngIf="isAuthenticated()" (click)="navigateToProfile(); closeProfileMenu()">
          <mat-icon>person</mat-icon>
          <span class="translate-text">{{ 'Profile' | t }}</span>
        </button>

        <button class="dropdown-item" (click)="navigateToSettings(); closeProfileMenu()">
          <mat-icon>settings</mat-icon>
          <span class="translate-text">{{ 'Settings' | t }}</span>
        </button>

        <div class="dropdown-submenu">
          <button class="dropdown-item has-submenu" (click)="toggleLanguageSubmenu()">
            <mat-icon>language</mat-icon>
            <span class="translate-text">{{ 'Language' | t }}</span>
            <mat-icon class="submenu-arrow" [class.open]="languageSubmenuOpen()">chevron_right</mat-icon>
          </button>
          <div class="submenu-content" [class.open]="languageSubmenuOpen()">
            <button 
              class="submenu-item" 
              [class.selected]="currentLang() === 'en'"
              (click)="changeLang('en'); closeProfileMenu()"
            >
              <span class="flag">ðŸ‡¬ðŸ‡§</span>
              <span>English</span>
              <mat-icon *ngIf="currentLang() === 'en'" class="check-icon">check</mat-icon>
            </button>
            <button 
              class="submenu-item" 
              [class.selected]="currentLang() === 'es'"
              (click)="changeLang('es'); closeProfileMenu()"
            >
              <span class="flag">ðŸ‡ªðŸ‡¸</span>
              <span>EspaÃ±ol</span>
              <mat-icon *ngIf="currentLang() === 'es'" class="check-icon">check</mat-icon>
            </button>
          </div>
        </div>

        <div class="dropdown-divider" *ngIf="isAuthenticated()"></div>

        <button class="dropdown-item sign-out" *ngIf="isAuthenticated()" (click)="logout(); closeProfileMenu()">
          <mat-icon>logout</mat-icon>
          <span class="translate-text">{{ 'Sign out' | t }}</span>
        </button>
      </div>
    </div>
  </div>
</nav>
